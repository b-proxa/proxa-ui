<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slide</title>
    <link rel="stylesheet" href="../css/tokens.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/elements/markdown.css">
    <link rel="stylesheet" href="../css/patterns/record.css">
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: var(--space-6);
            background: var(--gray-50);
        }
        .slide-wrapper {
            width: 100%;
            max-width: 960px;
        }
    </style>
</head>
<body>
    <div class="slide-wrapper">
        <div class="slide" id="slide">
            <div class="slide__title">
                <div class="slide__title-content">
                    <span class="slide__section-header" id="slide-section-header"></span>
                    <h1 id="slide-title"></h1>
                </div>
            </div>
            <div class="slide__description">
                <div class="slide__description-content">
                    <div class="markdown" id="slide-description"></div>
                </div>
            </div>
            <div class="slide__viz">
                <div class="slide__viz-header">
                    <span class="slide__viz-unit">USD $</span>
                    <div class="slide__viz-legend" id="chart-legend"></div>
                </div>
                <div class="slide__viz-content">
                    <div class="viz-view active">
                        <div class="chart-container">
                            <canvas id="chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

        const data = {
            sectionHeader: 'Fall 2025 Management Presentation',
            title: 'Financial Performance 2024',
            description: `## Key Highlights

**Revenue growth** of 108% year-over-year demonstrates strong market position.

### Trends
- Consistent upward trajectory across all quarters
- Expenses scaling efficiently with revenue
- Profit margins expanding in H2`,
            chart: {
                type: 'line',
                labels: ['2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06', '2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12'],
                series: [
                    { name: 'Revenue', color: '#4a6fa5', data: [1236577, 1425890, 1312445, 1567234, 1489012, 1723456, 1856789, 1645321, 1934567, 2123456, 2345678, 2567890] },
                    { name: 'Expenses', color: '#6b8f71', data: [856234, 912456, 878901, 1023456, 989123, 1145678, 1234567, 1098765, 1289012, 1412345, 1534567, 1678901] },
                    { name: 'Profit', color: '#c9a227', data: [380343, 513434, 433544, 543778, 499889, 577778, 622222, 546556, 645555, 711111, 811111, 888989] }
                ]
            },
            layout: {
                descWidth: '35',
                aspectRatio: '16/9'
            }
        };

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function formatLabel(label) {
            if (!label) return '';
            if (/^\d{4}-\d{2}$/.test(label)) {
                const [y, m] = label.split('-');
                return `${MONTHS[parseInt(m) - 1]} '${y.slice(2)}`;
            }
            return String(label);
        }

        function renderSlide() {
            document.getElementById('slide-section-header').textContent = data.sectionHeader;
            document.getElementById('slide-title').textContent = data.title;
            document.getElementById('slide-description').innerHTML = DOMPurify.sanitize(marked.parse(data.description));

            const slide = document.getElementById('slide');
            slide.style.setProperty('--col-split', data.layout.descWidth + '%');
            slide.style.aspectRatio = data.layout.aspectRatio;
        }

        let chart = null;
        function renderChart() {
            const ctx = document.getElementById('chart').getContext('2d');
            const labels = data.chart.labels.map(formatLabel);

            if (chart) chart.destroy();

            const chartType = data.chart.type;
            chart = new Chart(ctx, {
                type: chartType === 'area' ? 'line' : chartType,
                data: {
                    labels: labels,
                    datasets: data.chart.series.map(s => ({
                        label: s.name,
                        data: s.data,
                        borderColor: s.color,
                        backgroundColor: chartType === 'area' ? hexToRgba(s.color, 0.3) : chartType === 'bar' ? s.color : hexToRgba(s.color, 0.15),
                        borderWidth: chartType === 'bar' ? 0 : 2,
                        fill: chartType === 'area',
                        tension: 0.3,
                        pointBackgroundColor: s.color,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: { top: 10, right: 10, bottom: 5, left: 5 } },
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: { titleFont: { size: 12 }, bodyFont: { size: 11 }, padding: 10 }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 10 }, color: '#78716c' }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: '#e7e5e4' },
                            ticks: {
                                font: { size: 10 },
                                color: '#78716c',
                                callback: v => '$' + (v / 1000000).toFixed(1) + 'M'
                            }
                        }
                    }
                }
            });

            document.getElementById('chart-legend').innerHTML = data.chart.series
                .map(s => `<div class="legend-item"><span class="legend-color" style="background:${s.color}"></span><span>${s.name}</span></div>`)
                .join('');
        }

        renderSlide();
        renderChart();
    </script>
</body>
</html>

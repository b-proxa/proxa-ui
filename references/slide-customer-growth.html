<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slide â€” Customer Growth</title>
    <link rel="stylesheet" href="../css/tokens.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/elements/markdown.css">
    <link rel="stylesheet" href="../css/patterns/record.css">
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: var(--space-6);
            background: var(--gray-50);
        }
        .slide-wrapper {
            width: 100%;
            max-width: 960px;
        }
    </style>
</head>
<body>
    <div class="slide-wrapper">
        <div class="slide" id="slide">
            <div class="slide__title">
                <div class="slide__title-content">
                    <span class="slide__section-header" id="slide-section-header"></span>
                    <h1 id="slide-title"></h1>
                </div>
            </div>
            <div class="slide__description">
                <div class="slide__description-content">
                    <div class="markdown" id="slide-description"></div>
                </div>
            </div>
            <div class="slide__viz">
                <div class="slide__viz-header">
                    <span class="slide__viz-unit">Users (thousands)</span>
                    <div class="slide__viz-legend" id="chart-legend"></div>
                </div>
                <div class="slide__viz-content">
                    <div class="viz-view active">
                        <div class="chart-container">
                            <canvas id="chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

        const data = {
            sectionHeader: 'Fall 2025 Management Presentation',
            title: 'Customer Acquisition & Retention',
            description: `## Growth Summary

**Total active users** reached 48.2K by year end, up from 24.1K in January.

### Key Metrics
- Net new users averaged 2,200/month
- Churn rate decreased from 4.2% to 2.8%
- Enterprise segment grew 3x faster than SMB`,
            chart: {
                type: 'area',
                labels: ['2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06', '2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12'],
                series: [
                    { name: 'Active Users', color: '#4a6fa5', data: [24100, 26300, 28100, 29800, 31500, 33200, 35800, 38100, 40600, 43200, 45800, 48200] },
                    { name: 'New Signups', color: '#6b8f71', data: [3200, 3400, 3100, 3600, 3800, 3500, 4100, 3900, 4200, 4500, 4300, 4700] },
                    { name: 'Churned', color: '#c9604d', data: [1010, 1050, 980, 1020, 1100, 890, 950, 870, 810, 780, 720, 690] }
                ]
            },
            layout: {
                descWidth: '35',
                aspectRatio: '16/9'
            }
        };

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function formatLabel(label) {
            if (!label) return '';
            if (/^\d{4}-\d{2}$/.test(label)) {
                const [y, m] = label.split('-');
                return `${MONTHS[parseInt(m) - 1]} '${y.slice(2)}`;
            }
            return String(label);
        }

        function renderSlide() {
            document.getElementById('slide-section-header').textContent = data.sectionHeader;
            document.getElementById('slide-title').textContent = data.title;
            document.getElementById('slide-description').innerHTML = DOMPurify.sanitize(marked.parse(data.description));

            const slide = document.getElementById('slide');
            slide.style.setProperty('--col-split', data.layout.descWidth + '%');
            slide.style.aspectRatio = data.layout.aspectRatio;
        }

        let chart = null;
        function renderChart() {
            const ctx = document.getElementById('chart').getContext('2d');
            const labels = data.chart.labels.map(formatLabel);

            if (chart) chart.destroy();

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: data.chart.series.map(s => ({
                        label: s.name,
                        data: s.data,
                        borderColor: s.color,
                        backgroundColor: hexToRgba(s.color, 0.3),
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: s.color,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: { top: 10, right: 10, bottom: 5, left: 5 } },
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: { titleFont: { size: 12 }, bodyFont: { size: 11 }, padding: 10 }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 10 }, color: '#78716c' }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: '#e7e5e4' },
                            ticks: {
                                font: { size: 10 },
                                color: '#78716c',
                                callback: v => (v / 1000).toFixed(0) + 'K'
                            }
                        }
                    }
                }
            });

            document.getElementById('chart-legend').innerHTML = data.chart.series
                .map(s => `<div class="legend-item"><span class="legend-color" style="background:${s.color}"></span><span>${s.name}</span></div>`)
                .join('');
        }

        renderSlide();
        renderChart();
    </script>
</body>
</html>

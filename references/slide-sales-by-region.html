<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slide â€” Sales by Region</title>
    <link rel="stylesheet" href="../css/tokens.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/elements/markdown.css">
    <link rel="stylesheet" href="../css/patterns/record.css">
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: var(--space-6);
            background: var(--gray-50);
        }
        .slide-wrapper {
            width: 100%;
            max-width: 960px;
        }
    </style>
</head>
<body>
    <div class="slide-wrapper">
        <div class="slide" id="slide">
            <div class="slide__title">
                <div class="slide__title-content">
                    <span class="slide__section-header" id="slide-section-header"></span>
                    <h1 id="slide-title"></h1>
                </div>
            </div>
            <div class="slide__description">
                <div class="slide__description-content">
                    <div class="markdown" id="slide-description"></div>
                </div>
            </div>
            <div class="slide__viz">
                <div class="slide__viz-header">
                    <span class="slide__viz-unit">USD $</span>
                    <div class="slide__viz-legend" id="chart-legend"></div>
                </div>
                <div class="slide__viz-content">
                    <div class="viz-view active">
                        <div class="chart-container">
                            <canvas id="chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const data = {
            sectionHeader: 'Fall 2025 Management Presentation',
            title: 'Quarterly Sales by Region',
            description: `## Regional Breakdown

**West region** led all quarters with $14.2M total, driven by enterprise deals.

### Observations
- North showed strongest Q4 growth (+38% QoQ)
- South remained stable with consistent $2M+ per quarter
- East region recovering after Q2 dip`,
            chart: {
                type: 'bar',
                labels: ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024'],
                series: [
                    { name: 'West', color: '#4a6fa5', data: [3120000, 3450000, 3680000, 3950000] },
                    { name: 'North', color: '#6b8f71', data: [2340000, 2510000, 2780000, 3840000] },
                    { name: 'East', color: '#c9a227', data: [1890000, 1620000, 2150000, 2430000] },
                    { name: 'South', color: '#9b5de5', data: [2050000, 2180000, 2310000, 2540000] }
                ]
            },
            layout: {
                descWidth: '35',
                aspectRatio: '16/9'
            }
        };

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function renderSlide() {
            document.getElementById('slide-section-header').textContent = data.sectionHeader;
            document.getElementById('slide-title').textContent = data.title;
            document.getElementById('slide-description').innerHTML = DOMPurify.sanitize(marked.parse(data.description));

            const slide = document.getElementById('slide');
            slide.style.setProperty('--col-split', data.layout.descWidth + '%');
            slide.style.aspectRatio = data.layout.aspectRatio;
        }

        let chart = null;
        function renderChart() {
            const ctx = document.getElementById('chart').getContext('2d');

            if (chart) chart.destroy();

            const chartType = data.chart.type;
            chart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: data.chart.labels,
                    datasets: data.chart.series.map(s => ({
                        label: s.name,
                        data: s.data,
                        borderColor: s.color,
                        backgroundColor: chartType === 'bar' ? s.color : hexToRgba(s.color, 0.15),
                        borderWidth: chartType === 'bar' ? 0 : 2,
                        fill: false,
                        tension: 0.3,
                        pointBackgroundColor: s.color,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: { top: 10, right: 10, bottom: 5, left: 5 } },
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: { titleFont: { size: 12 }, bodyFont: { size: 11 }, padding: 10 }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 10 }, color: '#78716c' }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: '#e7e5e4' },
                            ticks: {
                                font: { size: 10 },
                                color: '#78716c',
                                callback: v => '$' + (v / 1000000).toFixed(1) + 'M'
                            }
                        }
                    }
                }
            });

            document.getElementById('chart-legend').innerHTML = data.chart.series
                .map(s => `<div class="legend-item"><span class="legend-color" style="background:${s.color}"></span><span>${s.name}</span></div>`)
                .join('');
        }

        renderSlide();
        renderChart();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brandon's Sandbox</title>
    <link rel="stylesheet" href="css/proxa.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Style Guide specific styles */
        .guide-section {
            margin-bottom: var(--space-8);
            padding-bottom: var(--space-6);
            border-bottom: 2px solid var(--gray-200);
        }
        .guide-section:last-child {
            border-bottom: none;
        }
        .guide-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }
        .guide-subtitle {
            font-size: var(--text-sm);
            color: var(--gray-500);
            margin-bottom: var(--space-5);
        }
        .guide-group {
            margin-bottom: var(--space-6);
        }
        .guide-group-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--space-3);
            padding-bottom: var(--space-2);
            border-bottom: 1px solid var(--gray-200);
        }
        .guide-row {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-3);
            align-items: flex-start;
            margin-bottom: var(--space-4);
        }
        .guide-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        .guide-label {
            font-size: var(--text-xs);
            color: var(--gray-400);
            font-family: var(--font-mono);
        }
        /* Color swatches */
        .color-swatch {
            width: 80px;
            height: 48px;
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }
        .color-swatch--wide {
            width: 120px;
        }
        /* Spacing demo */
        .spacing-demo {
            height: 24px;
            background: var(--accent);
            border-radius: var(--radius-sm);
        }
        /* Typography demo */
        .type-demo {
            color: var(--gray-800);
        }
        /* Shadow demo */
        .shadow-demo {
            width: 80px;
            height: 48px;
            background: white;
            border-radius: var(--radius-md);
        }
        /* Demo containers */
        .demo-box {
            padding: var(--space-4);
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
        }
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-4);
        }
        /* Tab system */
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* Ensure header stays on top */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        /* Pages layout with sidebar */
        .pages-layout {
            display: flex;
            height: calc(100vh - 52px);
            overflow: hidden;
        }
        .pages-sidebar {
            width: 220px;
            min-width: 220px;
            background: transparent;
            border-right: 1px solid var(--gray-200);
            padding: var(--space-4);
            overflow-y: auto;
        }
        .pages-sidebar__title {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--gray-400);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-3);
        }
        .pages-sidebar__list {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        .page-link {
            display: block;
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-sm);
            color: var(--gray-600);
            text-decoration: none;
            border-radius: var(--radius-sm);
            border-left: 2px solid transparent;
            margin-left: -2px;
            transition: all 0.15s ease;
        }
        .page-link:hover {
            background: var(--gray-100);
            color: var(--gray-800);
        }
        .page-link:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--accent-light);
        }
        .page-link:focus-visible {
            box-shadow: 0 0 0 2px var(--accent);
        }
        .page-link.active {
            background: var(--accent-light);
            color: var(--accent);
            font-weight: 500;
            border-left-color: var(--accent);
        }
        /* Page link with status badge */
        .page-link-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-2);
        }
        .status-badge {
            padding: 2px 6px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border-radius: 3px;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.15s ease;
        }
        .status-badge:hover {
            transform: scale(1.05);
        }
        .status-badge--ready {
            background: var(--fin-favorable-bg);
            color: var(--fin-favorable);
        }
        .status-badge--wip {
            background: #fef3c7;
            color: #b45309;
        }
        .status-badge--old {
            background: var(--gray-200);
            color: var(--gray-500);
        }
        /* Reference toolbar (above iframe) */
        .ref-toolbar {
            display: none;
            flex-direction: column;
            gap: var(--space-2);
            padding: var(--space-4) 0;
            margin-bottom: var(--space-3);
            border-bottom: 1px solid var(--gray-200);
        }
        .ref-toolbar.active {
            display: flex;
        }
        .ref-toolbar__header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: var(--space-4);
        }
        .ref-toolbar__info {
            flex: 1;
        }
        .ref-toolbar__title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
        }
        .ref-toolbar__description {
            font-size: var(--text-sm);
            color: var(--gray-500);
            line-height: 1.5;
        }
        .ref-toolbar__actions {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .ref-toolbar__meta {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        .ref-toolbar__status {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .ref-toolbar__label {
            font-size: var(--text-xs);
            color: var(--gray-400);
        }
        /* Share dropdown */
        .share-dropdown {
            position: relative;
        }
        .share-dropdown__btn {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-2);
            font-size: var(--text-xs);
            font-weight: 500;
            color: var(--gray-600);
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
        }
        .share-dropdown__btn:hover {
            background: var(--gray-200);
        }
        .share-dropdown__menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: var(--space-1);
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-md);
            min-width: 140px;
            z-index: 100;
        }
        .share-dropdown__menu.open {
            display: block;
        }
        .share-dropdown__item {
            display: block;
            width: 100%;
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-xs);
            color: var(--gray-700);
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
        }
        .share-dropdown__item:hover {
            background: var(--gray-100);
        }
        /* Notes panel (slide-out drawer) */
        .notes-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            max-width: 90vw;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: transform 0.25s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        .notes-panel.open {
            transform: translateX(0);
        }
        .notes-panel__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }
        .notes-panel__title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--gray-900);
        }
        .notes-panel__close {
            padding: var(--space-1) var(--space-2);
            font-size: var(--text-sm);
            color: var(--gray-500);
            background: none;
            border: none;
            cursor: pointer;
        }
        .notes-panel__close:hover {
            color: var(--gray-700);
        }
        .notes-panel__body {
            flex: 1;
            padding: var(--space-4);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .notes-panel__editor {
            flex: 1;
            width: 100%;
            padding: var(--space-3);
            font-family: var(--font-mono);
            font-size: var(--text-sm);
            line-height: 1.6;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            resize: none;
        }
        .notes-panel__editor:focus {
            outline: none;
            border-color: var(--accent);
        }
        .notes-panel__status {
            margin-top: var(--space-2);
            font-size: var(--text-xs);
            color: var(--gray-400);
        }
        .notes-panel__overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.3);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.25s ease, visibility 0.25s ease;
            z-index: 999;
        }
        .notes-panel__overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .pages-preview {
            flex: 1;
            background: var(--gray-100);
            padding: var(--space-4);
            overflow: hidden;
        }
        .pages-preview__frame {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        /* Mobile menu button - hidden on desktop */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            bottom: var(--space-4);
            right: var(--space-4);
            width: 56px;
            height: 56px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            z-index: 9999;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.2s ease;
            font-weight: bold;
        }
        .mobile-menu-btn:hover {
            background: var(--gray-700);
            transform: scale(1.05);
        }
        .mobile-menu-btn:active {
            transform: scale(0.95);
        }

        /* Mobile sidebar backdrop */
        .sidebar-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9997;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .sidebar-backdrop.active {
            opacity: 1;
        }
        /* Record iframe layout */
        .record-layout {
            height: calc(100vh - 52px);
            overflow: hidden;
        }
        .record-layout__frame {
            width: 100%;
            height: 100%;
            border: none;
        }
        /* Sandbox layout */
        .sandbox-layout {
            padding: var(--space-6);
            max-width: 1100px;
            margin: 0 auto;
        }
        .sandbox-header {
            margin-bottom: var(--space-6);
        }
        .sandbox-header__title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }
        .sandbox-header__subtitle {
            font-size: var(--text-sm);
            color: var(--gray-500);
        }
        .sandbox-area {
            min-height: 400px;
            background: white;
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-400);
            font-size: var(--text-sm);
        }
        /* Home page */
        .home-layout {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-6);
        }
        .home-hero {
            text-align: center;
            margin-bottom: var(--space-8);
        }
        .home-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }
        .home-subtitle {
            font-size: var(--text-base);
            color: var(--gray-500);
            max-width: 500px;
            margin: 0 auto;
        }
        /* 8-bit Pixel Art - Proxa Logo */
        .pixel-art {
            margin-top: var(--space-8);
            margin-bottom: var(--space-6);
        }
        .pixel-grid {
            display: grid;
            grid-template-columns: repeat(10, 10px);
            gap: 1px;
            justify-content: center;
            background: #1a1625;
            padding: 20px;
            border-radius: var(--radius-lg);
            width: fit-content;
            margin: 0 auto;
        }
        .px {
            width: 10px;
            height: 10px;
            background: #1a1625;
        }
        .px.w { background: #f5f5f5; }
        .px.g { background: #a0a0a0; }
        /* Password Gate */
        .password-gate {
            position: fixed;
            inset: 0;
            background: white;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: var(--space-4);
        }
        .password-gate.hidden { display: none; }
        .password-gate__title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-800);
        }
        .password-gate__form {
            display: flex;
            gap: var(--space-2);
        }
        .password-gate__input {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: var(--text-sm);
            width: 200px;
        }
        .password-gate__input:focus {
            outline: none;
            border-color: var(--accent);
        }
        .password-gate__error {
            color: var(--error);
            font-size: var(--text-sm);
            height: 20px;
        }

        /* ===================================
           MOBILE RESPONSIVE STYLES
           =================================== */

        @media (max-width: 768px) {
            /* App header adjustments */
            .app-header {
                flex-wrap: wrap;
                padding: var(--space-3);
            }

            .app-header__divider {
                display: none;
            }

            .app-tabs {
                width: 100%;
                overflow-x: auto;
                margin-top: var(--space-2);
                padding-bottom: var(--space-2);
                gap: var(--space-1);
            }

            .app-tab {
                white-space: nowrap;
                padding: var(--space-2) var(--space-3);
                font-size: var(--text-sm);
            }

            /* Pages layout - hamburger menu on mobile */
            .pages-layout {
                flex-direction: row;
                height: calc(100vh - 52px);
            }

            /* Show mobile menu button */
            .mobile-menu-btn {
                display: flex;
            }

            /* Show backdrop when active */
            .sidebar-backdrop {
                display: block;
            }

            /* Hide sidebar by default, show as overlay when active */
            .pages-sidebar {
                position: fixed;
                top: 0;
                left: -280px;
                width: 280px;
                min-width: 280px;
                height: 100vh;
                background: white;
                border-right: 1px solid var(--gray-200);
                padding: var(--space-4);
                overflow-y: auto;
                z-index: 9998;
                transition: left 0.3s ease;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            }

            .pages-sidebar.active {
                left: 0;
            }

            .pages-sidebar__title {
                font-size: var(--text-xs);
            }

            .page-link {
                padding: var(--space-2) var(--space-3);
                font-size: var(--text-sm);
            }

            /* Preview takes full width */
            .pages-preview {
                width: 100%;
                height: calc(100vh - 52px);
                padding: 0;
            }

            .pages-preview__frame {
                border-radius: 0;
                border: none;
            }

            /* Content padding adjustments */
            .app-content {
                padding: var(--space-4);
            }

            /* Demo grids */
            .demo-grid {
                grid-template-columns: 1fr;
            }

            /* Guide sections */
            .guide-section {
                margin-bottom: var(--space-6);
                padding-bottom: var(--space-4);
            }

            .guide-row {
                flex-direction: column;
                align-items: stretch;
            }

            /* Color swatches */
            .color-swatch {
                width: 100%;
                max-width: 200px;
            }

            /* Sandbox tab */
            #tab-sandbox {
                padding: var(--space-4);
            }
        }

        @media (max-width: 480px) {
            /* Even smaller screens */
            .app-header {
                padding: var(--space-2);
            }

            .app-content {
                padding: var(--space-3);
            }

            .pages-sidebar {
                width: 260px;
                min-width: 260px;
                left: -260px;
                padding: var(--space-3);
            }

            .mobile-menu-btn {
                width: 48px;
                height: 48px;
                font-size: 20px;
                bottom: var(--space-3);
                right: var(--space-3);
            }

            .pages-preview {
                height: calc(100vh - 52px);
            }

            .guide-title {
                font-size: 1.25rem;
            }

            .demo-box {
                padding: var(--space-3);
            }
        }
    </style>
</head>
<body>
    <!-- Password Gate -->
    <div class="password-gate" id="password-gate">
        <div class="password-gate__title">Enter Password</div>
        <div class="password-gate__form">
            <input type="password" class="password-gate__input" id="password-input" placeholder="Password" autofocus>
            <button class="btn btn--primary" onclick="checkPassword()">Enter</button>
        </div>
        <div class="password-gate__error" id="password-error"></div>
    </div>

    <script>
        const SITE_PASSWORD = 'proxa';
        const STORAGE_KEY = 'proxa-auth';

        function checkPassword() {
            const input = document.getElementById('password-input');
            if (input.value === SITE_PASSWORD) {
                sessionStorage.setItem(STORAGE_KEY, 'true');
                document.getElementById('password-gate').classList.add('hidden');
            } else {
                document.getElementById('password-error').textContent = 'Incorrect password';
                input.value = '';
                input.focus();
            }
        }

        document.getElementById('password-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') checkPassword();
        });

        // Check if already authenticated this session
        if (sessionStorage.getItem(STORAGE_KEY) === 'true') {
            document.getElementById('password-gate').classList.add('hidden');
        }
    </script>

    <!-- Header -->
    <header class="app-header">
        <span class="app-header__logo">Proxa</span>
        <div class="app-header__divider"></div>
        <span class="app-header__title">Sandbox</span>
        <nav class="app-tabs">
            <button class="app-tab active" data-tab="home" onclick="switchTab('home')">Home</button>
            <button class="app-tab" data-tab="record" onclick="switchTab('record')">Record</button>
            <button class="app-tab" data-tab="references" onclick="switchTab('references')">References</button>
        </nav>
    </header>

    <!-- Home Tab -->
    <div class="tab-content active" id="tab-home">
        <div class="home-layout">
            <div class="home-hero">
                <!-- 8-bit Proxa Logo -->
                <div class="pixel-art">
                    <div class="pixel-grid">
                        <!-- Row 1: Arrow tip -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 2: Arrow -->
                        <div class="px"></div><div class="px w"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 3: P top with arrow -->
                        <div class="px w"></div><div class="px"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 4: P bowl top -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 5: P bowl -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 6: P bowl bottom -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 7: Stem -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 8: Stem -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 9: Stem -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 10: Stem base -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                    </div>
                </div>
                <h1 class="home-title">Brandon's Sandbox</h1>
                <p class="home-subtitle">A prototyping environment for UI components, patterns, and AI-powered workflows.</p>
            </div>
        </div>
    </div>

    <!-- Record Tab -->
    <div class="tab-content" id="tab-record">
        <div class="record-layout">
            <iframe src="patterns/record.html" class="record-layout__frame" id="record-frame"></iframe>
        </div>
    </div>

    <!-- References Tab -->
    <div class="tab-content" id="tab-references">
        <div class="pages-layout">
            <aside class="pages-sidebar">
                <div class="pages-sidebar__title">Documents</div>
                <div class="pages-sidebar__list">
                    <a href="#" class="page-link active" onclick="loadReference(this, 'references/index.html'); return false;">All Files</a>
                    <a href="#" class="page-link" onclick="loadReference(this, 'references/notes.html'); return false;">Notes</a>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="audit-report" onclick="loadReference(this, 'references/audit-report.html'); return false;">Audit Report</a>
                        <span class="status-badge status-badge--ready" data-page="audit-report" onclick="cycleStatus(this)">Ready</span>
                    </div>
                </div>
                <div class="pages-sidebar__title" style="margin-top: var(--space-5);">Specs</div>
                <div class="pages-sidebar__list">
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="ai-blocks" onclick="loadReference(this, 'references/ai-blocks.html'); return false;">AI Blocks</a>
                        <span class="status-badge status-badge--wip" data-page="ai-blocks" onclick="cycleStatus(this)">WIP</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="responsive-slide" onclick="loadReference(this, 'references/responsive-slide.html'); return false;">Responsive Slide</a>
                        <span class="status-badge status-badge--ready" data-page="responsive-slide" onclick="cycleStatus(this)">Ready</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="slide-layout-builder" onclick="loadReference(this, 'references/slide-layout-builder.html'); return false;">Slide Layout Builder</a>
                        <span class="status-badge status-badge--old" data-page="slide-layout-builder" onclick="cycleStatus(this)">Old</span>
                    </div>
                </div>
                <div class="pages-sidebar__title" style="margin-top: var(--space-5);">Prototypes</div>
                <div class="pages-sidebar__list">
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="financial-statement" onclick="loadReference(this, '_prototypes/financial-statement-real.html'); return false;">Financial Statement</a>
                        <span class="status-badge status-badge--ready" data-page="financial-statement" onclick="cycleStatus(this)">Ready</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="trend-dashboard" onclick="loadReference(this, '_prototypes/trend-dashboard.html'); return false;">Trend Dashboard</a>
                        <span class="status-badge status-badge--ready" data-page="trend-dashboard" onclick="cycleStatus(this)">Ready</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="waterfall-chart" onclick="loadReference(this, '_prototypes/waterfall-chart.html'); return false;">Waterfall Chart</a>
                        <span class="status-badge status-badge--ready" data-page="waterfall-chart" onclick="cycleStatus(this)">Ready</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="comparison-table" onclick="loadReference(this, '_prototypes/comparison-table.html'); return false;">Comparison Table</a>
                        <span class="status-badge status-badge--ready" data-page="comparison-table" onclick="cycleStatus(this)">Ready</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="metric-blocks" onclick="loadReference(this, '_prototypes/metric-blocks.html'); return false;">Metric Blocks</a>
                        <span class="status-badge status-badge--ready" data-page="metric-blocks" onclick="cycleStatus(this)">Ready</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="variance-bars" onclick="loadReference(this, '_prototypes/variance-bars.html'); return false;">Variance Bars</a>
                        <span class="status-badge status-badge--ready" data-page="variance-bars" onclick="cycleStatus(this)">Ready</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="competitive-analysis" onclick="loadReference(this, '_prototypes/competitive-analysis.html'); return false;">Competitive Analysis</a>
                        <span class="status-badge status-badge--wip" data-page="competitive-analysis" onclick="cycleStatus(this)">WIP</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="selkirk-dashboard" onclick="loadReference(this, '_prototypes/selkirk-dashboard.html'); return false;">Selkirk Dashboard</a>
                        <span class="status-badge status-badge--ready" data-page="selkirk-dashboard" onclick="cycleStatus(this)">Ready</span>
                    </div>
                    <div class="page-link-row">
                        <a href="#" class="page-link" data-page="design-system-v2" onclick="loadReference(this, '_prototypes/proxa-design-system-v2.html'); return false;">Design System v2</a>
                        <span class="status-badge status-badge--old" data-page="design-system-v2" onclick="cycleStatus(this)">Old</span>
                    </div>
                </div>
            </aside>
            <div class="pages-preview">
                <div class="ref-toolbar" id="ref-toolbar">
                    <div class="ref-toolbar__header">
                        <div class="ref-toolbar__info">
                            <h1 class="ref-toolbar__title" id="ref-toolbar-title">Page Title</h1>
                            <p class="ref-toolbar__description" id="ref-toolbar-description">Page description goes here.</p>
                        </div>
                        <div class="ref-toolbar__actions">
                            <a href="#" id="ref-download-btn" class="btn" download>Download</a>
                            <div class="share-dropdown">
                                <button class="share-dropdown__btn" onclick="toggleShareMenu()">
                                    Share ▾
                                </button>
                                <div class="share-dropdown__menu" id="share-menu">
                                    <button class="share-dropdown__item" onclick="copyRefLink()">Copy Link</button>
                                    <button class="share-dropdown__item" onclick="openInNewTab()">Open in New Tab</button>
                                </div>
                            </div>
                            <button class="btn btn--secondary" onclick="openNotesPanel()">Notes</button>
                        </div>
                    </div>
                    <div class="ref-toolbar__meta">
                        <div class="ref-toolbar__status">
                            <span class="ref-toolbar__label">Status:</span>
                            <span id="ref-status-badge" class="status-badge status-badge--old" onclick="cycleRefStatus()">Old</span>
                        </div>
                    </div>
                </div>
                <iframe src="references/index.html" class="pages-preview__frame" id="references-frame"></iframe>
            </div>
        </div>
    </div>

    <!-- Demo Modal -->
    <div class="modal-overlay" id="demo-modal">
        <div class="modal">
            <div class="modal__header">
                <span class="modal__title">Modal Title</span>
                <button class="modal__close" onclick="document.getElementById('demo-modal').classList.remove('open')">×</button>
            </div>
            <div class="modal__body">
                <p style="font-size: var(--text-sm); color: var(--gray-600);">This is a modal dialog. Modals are used for focused tasks, confirmations, or displaying important information.</p>
            </div>
            <div class="modal__footer modal__footer--right">
                <button class="btn" onclick="document.getElementById('demo-modal').classList.remove('open')">Cancel</button>
                <button class="btn btn--primary" onclick="document.getElementById('demo-modal').classList.remove('open')">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Demo Slide Panel -->
    <div class="overlay" onclick="closePanel()"></div>
    <div class="panel" id="demo-panel">
        <div class="panel__header">
            <span class="panel__title">Panel Title</span>
            <button class="panel__close" onclick="closePanel()">×</button>
        </div>
        <div class="panel__content">
            <div class="panel-section">
                <div class="panel-section__title">Section</div>
                <p style="font-size: var(--text-sm); color: var(--gray-600);">Slide panels appear from the right side of the screen. They're used for detail views, settings, and secondary content.</p>
            </div>
        </div>
    </div>

    <!-- Tab switching (runs immediately, no dependencies) -->
    <script>
        function switchTab(tabName) {
            // Update active tab button
            document.querySelectorAll('.app-tab[data-tab]').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tabName);
            });
            // Show target content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === 'tab-' + tabName);
            });
        }
        window.switchTab = switchTab;
        window.switchToTab = switchTab; // alias for style guide button

        // Page sidebar navigation
        function loadPage(link, pageSrc) {
            // Update active link in pages sidebar only
            document.querySelectorAll('#tab-pages .page-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            // Load page in iframe
            document.getElementById('pages-frame').src = pageSrc;
        }
        window.loadPage = loadPage;

        // Style guide sidebar navigation
        function loadStyleGuide(link, pageSrc) {
            // Update active link in styleguide sidebar only
            document.querySelectorAll('#tab-styleguide .page-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            // Load page in iframe
            document.getElementById('styleguide-frame').src = pageSrc;
        }
        window.loadStyleGuide = loadStyleGuide;

        // References sidebar navigation
        let currentRefPage = null;
        let currentRefSrc = 'references/index.html';

        // Page metadata for toolbar
        const PAGE_META = {
            'audit-report': {
                title: 'Code Audit Report',
                description: 'Comprehensive audit of the Proxa UI design system covering consistency, components, code quality, and design system alignment.',
                download: 'AUDIT-REPORT.md'
            },
            'ai-blocks': {
                title: 'AI Blocks Specification',
                description: 'Feature specification for declarative AI automation - persistent, re-runnable prompts with human-in-the-loop review.',
                download: 'references/AI-BLOCKS.md'
            },
            'responsive-slide': {
                title: 'Responsive Slide Layout',
                description: 'CSS patterns for creating presentation slides and cards with fixed headers and flexible content zones.',
                download: 'references/RESPONSIVE-SLIDE.md'
            },
            'slide-layout-builder': {
                title: 'Slide Layout Builder',
                description: 'Interactive tool for building presentation slides with configurable layouts and aspect ratios.',
                download: null
            },
            'financial-statement': {
                title: 'Financial Statement',
                description: 'Income statement prototype with variance analysis and financial data visualization.',
                download: null
            },
            'trend-dashboard': {
                title: 'Trend Dashboard',
                description: 'Multi-metric dashboard with trend charts and KPI tracking.',
                download: null
            },
            'waterfall-chart': {
                title: 'Waterfall Chart',
                description: 'Variance waterfall visualization showing changes between periods.',
                download: null
            },
            'comparison-table': {
                title: 'Comparison Table',
                description: 'Side-by-side data comparison with highlighting and variance indicators.',
                download: null
            },
            'metric-blocks': {
                title: 'Metric Blocks',
                description: 'Compact metric display components for dashboards and reports.',
                download: null
            },
            'variance-bars': {
                title: 'Variance Bars',
                description: 'Horizontal variance bar charts for comparing actual vs budget.',
                download: null
            },
            'competitive-analysis': {
                title: 'Competitive Analysis',
                description: 'Market comparison visualization with competitor metrics.',
                download: null
            },
            'selkirk-dashboard': {
                title: 'Selkirk Dashboard',
                description: 'Custom dashboard implementation with multiple data views.',
                download: null
            },
            'design-system-v2': {
                title: 'Design System v2',
                description: 'Updated design system documentation and component library.',
                download: null
            }
        };

        function loadReference(link, pageSrc) {
            // Update active link in references sidebar only
            document.querySelectorAll('#tab-references .page-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            // Load page in iframe
            document.getElementById('references-frame').src = pageSrc;
            currentRefSrc = pageSrc;

            // Update toolbar
            const pageId = link.dataset?.page;
            const toolbar = document.getElementById('ref-toolbar');
            const titleEl = document.getElementById('ref-toolbar-title');
            const descEl = document.getElementById('ref-toolbar-description');
            const downloadBtn = document.getElementById('ref-download-btn');
            const meta = PAGE_META[pageId];

            if (pageId && meta) {
                currentRefPage = pageId;
                toolbar.classList.add('active');
                titleEl.textContent = meta.title;
                descEl.textContent = meta.description;

                // Update download button
                if (meta.download) {
                    downloadBtn.href = meta.download;
                    downloadBtn.style.display = 'inline-flex';
                } else {
                    downloadBtn.style.display = 'none';
                }

                updateRefToolbarStatus(pageId);
            } else {
                currentRefPage = null;
                toolbar.classList.remove('active');
            }

            // Close share menu if open
            document.getElementById('share-menu').classList.remove('open');
        }
        window.loadReference = loadReference;

        // Update toolbar status badge
        async function updateRefToolbarStatus(pageId) {
            try {
                const res = await fetch('/api/status');
                const statuses = await res.json();
                const status = statuses[pageId] || 'wip';
                const badge = document.getElementById('ref-status-badge');
                badge.className = `status-badge status-badge--${status}`;
                badge.textContent = STATUS_LABELS[status];
            } catch (err) {}
        }

        // Cycle status from toolbar
        async function cycleRefStatus() {
            if (!currentRefPage) return;
            const badge = document.getElementById('ref-status-badge');
            const currentClass = [...badge.classList].find(c => c.startsWith('status-badge--'));
            const currentStatus = currentClass ? currentClass.replace('status-badge--', '') : 'wip';
            const nextStatus = STATUS_ORDER[(STATUS_ORDER.indexOf(currentStatus) + 1) % STATUS_ORDER.length];

            // Update toolbar badge
            badge.classList.remove(`status-badge--${currentStatus}`);
            badge.classList.add(`status-badge--${nextStatus}`);
            badge.textContent = STATUS_LABELS[nextStatus];

            // Update sidebar badge too
            const sidebarBadge = document.querySelector(`.status-badge[data-page="${currentRefPage}"]`);
            if (sidebarBadge) {
                sidebarBadge.classList.remove(`status-badge--${currentStatus}`);
                sidebarBadge.classList.add(`status-badge--${nextStatus}`);
                sidebarBadge.textContent = STATUS_LABELS[nextStatus];
            }

            // Save to API
            try {
                await fetch('/api/status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ page: currentRefPage, status: nextStatus })
                });
            } catch (err) {}
        }
        window.cycleRefStatus = cycleRefStatus;

        // Share dropdown
        function toggleShareMenu() {
            document.getElementById('share-menu').classList.toggle('open');
        }
        window.toggleShareMenu = toggleShareMenu;

        function copyRefLink() {
            const url = window.location.origin + '/' + currentRefSrc;
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied!');
            });
            document.getElementById('share-menu').classList.remove('open');
        }
        window.copyRefLink = copyRefLink;

        function openInNewTab() {
            window.open(currentRefSrc, '_blank');
            document.getElementById('share-menu').classList.remove('open');
        }
        window.openInNewTab = openInNewTab;

        // Notes panel functionality
        let notesSaveTimeout;
        const notesEditor = document.getElementById('notes-panel-editor');
        const notesStatus = document.getElementById('notes-panel-status');

        async function openNotesPanel() {
            if (!currentRefPage) return;

            const panel = document.getElementById('notes-panel');
            const overlay = document.getElementById('notes-overlay');
            const title = document.getElementById('notes-panel-title');
            const meta = PAGE_META[currentRefPage];

            title.textContent = `Notes: ${meta?.title || currentRefPage}`;
            panel.classList.add('open');
            overlay.classList.add('open');

            // Load notes for this page
            notesStatus.textContent = 'Loading...';
            try {
                const res = await fetch(`/api/page-notes?page=${currentRefPage}`);
                const data = await res.json();
                notesEditor.value = data.notes || '';
                notesStatus.textContent = 'Saved';
            } catch (err) {
                console.error('Failed to load notes:', err);
                notesStatus.textContent = 'Error loading';
            }

            notesEditor.focus();
        }
        window.openNotesPanel = openNotesPanel;

        function closeNotesPanel() {
            document.getElementById('notes-panel').classList.remove('open');
            document.getElementById('notes-overlay').classList.remove('open');
        }
        window.closeNotesPanel = closeNotesPanel;

        // Auto-save notes on typing
        notesEditor.addEventListener('input', () => {
            notesStatus.textContent = 'Saving...';
            clearTimeout(notesSaveTimeout);
            notesSaveTimeout = setTimeout(savePageNotes, 500);
        });

        async function savePageNotes() {
            if (!currentRefPage) return;

            try {
                await fetch('/api/page-notes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        page: currentRefPage,
                        notes: notesEditor.value
                    })
                });
                notesStatus.textContent = 'Saved';
            } catch (err) {
                console.error('Failed to save notes:', err);
                notesStatus.textContent = 'Error saving';
            }
        }

        // Close panel with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeNotesPanel();
            }
        });

        // Close share menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.share-dropdown')) {
                document.getElementById('share-menu')?.classList.remove('open');
            }
        });

        // Status badge cycling
        const STATUS_ORDER = ['ready', 'wip', 'old'];
        const STATUS_LABELS = { ready: 'Ready', wip: 'WIP', old: 'Old' };

        async function cycleStatus(badge) {
            const page = badge.dataset.page;
            const currentClass = [...badge.classList].find(c => c.startsWith('status-badge--'));
            const currentStatus = currentClass ? currentClass.replace('status-badge--', '') : 'ready';
            const currentIndex = STATUS_ORDER.indexOf(currentStatus);
            const nextStatus = STATUS_ORDER[(currentIndex + 1) % STATUS_ORDER.length];

            // Update UI immediately
            badge.classList.remove(`status-badge--${currentStatus}`);
            badge.classList.add(`status-badge--${nextStatus}`);
            badge.textContent = STATUS_LABELS[nextStatus];

            // Save to API
            try {
                await fetch('/api/status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ page, status: nextStatus })
                });
            } catch (err) {
                console.error('Failed to save status:', err);
            }
        }
        window.cycleStatus = cycleStatus;

        // Load statuses on page load
        async function loadStatuses() {
            try {
                const res = await fetch('/api/status');
                const statuses = await res.json();
                Object.entries(statuses).forEach(([page, status]) => {
                    const badge = document.querySelector(`.status-badge[data-page="${page}"]`);
                    if (badge) {
                        badge.className = `status-badge status-badge--${status}`;
                        badge.textContent = STATUS_LABELS[status];
                    }
                });
            } catch (err) {
                console.error('Failed to load statuses:', err);
            }
        }
        loadStatuses();
    </script>

    <script type="module">
        import { initDropdowns } from './js/dropdown.js';
        import { showToast } from './js/toast.js';
        import { openPanel, closePanel, initPanels } from './js/slide-panel.js';

        // Make functions globally available for onclick handlers
        window.showToast = showToast;
        window.openPanel = openPanel;
        window.closePanel = closePanel;

        // Initialize
        initDropdowns();
        initPanels();

        // Modal: Escape key and backdrop click to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.open').forEach(m => m.classList.remove('open'));
            }
        });
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) overlay.classList.remove('open');
            });
        });

        // Pages sidebar navigation
        const pageLinks = document.querySelectorAll('.page-link');
        const pagesFrame = document.getElementById('pages-frame');

        pageLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageSrc = link.dataset.page;

                // Update active link
                pageLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                // Load page in iframe
                pagesFrame.src = pageSrc;
            });
        });

        // Demo Chart (Chart.js) - 12-month financial data from prototype
        const chartData = {
            labels: ["Jan '24", "Feb '24", "Mar '24", "Apr '24", "May '24", "Jun '24", "Jul '24", "Aug '24", "Sep '24", "Oct '24", "Nov '24", "Dec '24"],
            datasets: [
                {
                    label: 'Revenue',
                    data: [1236577, 1425890, 1312445, 1567234, 1489012, 1723456, 1856789, 1645321, 1934567, 2123456, 2345678, 2567890],
                    borderColor: '#4a6fa5',
                    backgroundColor: 'rgba(74, 111, 165, 0.1)',
                    fill: true,
                    tension: 0.3
                },
                {
                    label: 'Expenses',
                    data: [856234, 912456, 878901, 1023456, 989123, 1145678, 1234567, 1098765, 1289012, 1412345, 1534567, 1678901],
                    borderColor: '#6b8f71',
                    backgroundColor: 'rgba(107, 143, 113, 0.1)',
                    fill: true,
                    tension: 0.3
                },
                {
                    label: 'Profit',
                    data: [380343, 513434, 433544, 543778, 499889, 577778, 622222, 546556, 645555, 711111, 811111, 888989],
                    borderColor: '#c9a227',
                    backgroundColor: 'rgba(201, 162, 39, 0.1)',
                    fill: true,
                    tension: 0.3
                }
            ]
        };

        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { font: { size: 10 }, color: '#78716c' }
                },
                y: {
                    grid: { color: '#e7e5e4' },
                    ticks: {
                        font: { size: 10 },
                        color: '#78716c',
                        callback: v => '$' + (v/1000000).toFixed(1) + 'M'
                    }
                }
            }
        };

        const demoChart = new Chart(document.getElementById('demo-chart'), {
            type: 'line',
            data: chartData,
            options: chartOptions
        });

        // Update legend
        document.getElementById('demo-chart-legend').innerHTML = chartData.datasets.map(d => `
            <div class="legend-item">
                <span class="legend-color" style="background: ${d.borderColor}"></span>
                ${d.label}
            </div>
        `).join('');

        // Chart type switcher
        document.getElementById('demo-chart-type').addEventListener('change', (e) => {
            const type = e.target.value;
            demoChart.config.type = type;
            demoChart.data.datasets.forEach(d => {
                d.fill = type === 'line';
                d.borderWidth = type === 'bar' ? 0 : 2;
                d.backgroundColor = type === 'bar' ? d.borderColor : d.backgroundColor;
            });
            demoChart.update();
        });

        // Demo Waterfall Chart - Revenue to Profit bridge (values in $M)
        const waterfallData = [
            { label: 'Revenue', sublabel: '2024', value: 20.2, type: 'total' },
            { label: 'Tour', sublabel: 'Packages', value: 2.4, type: 'increase' },
            { label: 'Services', sublabel: '', value: 1.8, type: 'increase' },
            { label: 'COGS', sublabel: '', value: -5.2, type: 'decrease' },
            { label: 'OpEx', sublabel: '', value: -8.8, type: 'decrease' },
            { label: 'Profit', sublabel: '2024', value: 6.2, type: 'total' }
        ];

        const maxVal = Math.max(...waterfallData.map(d => Math.abs(d.value)));
        const scale = 180 / maxVal;
        let runningTotal = 0;

        const waterfallHTML = waterfallData.map((item, i) => {
            let barHeight, barBottom;

            if (item.type === 'total') {
                barHeight = item.value * scale;
                barBottom = 0;
                runningTotal = item.value;
            } else {
                barHeight = Math.abs(item.value) * scale;
                if (item.value > 0) {
                    barBottom = runningTotal * scale;
                    runningTotal += item.value;
                } else {
                    runningTotal += item.value;
                    barBottom = runningTotal * scale;
                }
            }

            const barClass = item.type === 'total' ? 'waterfall__bar--total' :
                           item.value > 0 ? 'waterfall__bar--increase' : 'waterfall__bar--decrease';

            return `
                <div class="waterfall__bar-group">
                    <div class="waterfall__bar-wrapper" style="bottom: ${barBottom}px">
                        <div class="waterfall__bar ${barClass}" style="height: ${barHeight}px">
                            <span class="waterfall__value">${item.value > 0 && item.type !== 'total' ? '+' : ''}$${Math.abs(item.value).toFixed(1)}M</span>
                        </div>
                    </div>
                    <div class="waterfall__label">
                        <strong>${item.label}</strong>
                        ${item.sublabel}
                    </div>
                </div>
            `;
        }).join('');

        document.getElementById('demo-waterfall').innerHTML = waterfallHTML + '<div class="waterfall__axis"></div>';
    </script>

    <script>
        // Mobile menu functionality - wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.querySelector('#tab-pages .pages-sidebar');
            const backdrop = document.getElementById('sidebar-backdrop');

            function toggleMobileMenu() {
                if (!sidebar || !backdrop || !mobileMenuBtn) return;

                const isOpen = sidebar.classList.contains('active');

                if (isOpen) {
                    // Close menu
                    sidebar.classList.remove('active');
                    backdrop.classList.remove('active');
                    mobileMenuBtn.textContent = '☰';
                } else {
                    // Open menu
                    sidebar.classList.add('active');
                    backdrop.classList.add('active');
                    mobileMenuBtn.textContent = '✕';
                }
            }

            function closeMobileMenu() {
                if (!sidebar || !backdrop || !mobileMenuBtn) return;

                sidebar.classList.remove('active');
                backdrop.classList.remove('active');
                mobileMenuBtn.textContent = '☰';
            }

            // Toggle menu on button click
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleMobileMenu();
                });
            }

            // Close menu when backdrop is clicked
            if (backdrop) {
                backdrop.addEventListener('click', closeMobileMenu);
            }

            // Close menu when a page link is clicked
            document.querySelectorAll('#tab-pages .page-link').forEach(link => {
                link.addEventListener('click', () => {
                    setTimeout(closeMobileMenu, 100);
                });
            });
        });
    </script>

    <!-- Notes Panel (slide-out drawer) -->
    <div class="notes-panel__overlay" id="notes-overlay" onclick="closeNotesPanel()"></div>
    <div class="notes-panel" id="notes-panel">
        <div class="notes-panel__header">
            <span class="notes-panel__title" id="notes-panel-title">Page Notes</span>
            <button class="notes-panel__close" onclick="closeNotesPanel()">&times; Close</button>
        </div>
        <div class="notes-panel__body">
            <textarea class="notes-panel__editor" id="notes-panel-editor" placeholder="Add notes for this page..."></textarea>
            <div class="notes-panel__status" id="notes-panel-status">Saved</div>
        </div>
    </div>
</body>
</html>

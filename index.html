<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brandon's Sandbox</title>
    <link rel="stylesheet" href="css/proxa.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Style Guide specific styles */
        .guide-section {
            margin-bottom: var(--space-8);
            padding-bottom: var(--space-6);
            border-bottom: 2px solid var(--gray-200);
        }
        .guide-section:last-child {
            border-bottom: none;
        }
        .guide-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }
        .guide-subtitle {
            font-size: var(--text-sm);
            color: var(--gray-500);
            margin-bottom: var(--space-5);
        }
        .guide-group {
            margin-bottom: var(--space-6);
        }
        .guide-group-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--space-3);
            padding-bottom: var(--space-2);
            border-bottom: 1px solid var(--gray-200);
        }
        .guide-row {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-3);
            align-items: flex-start;
            margin-bottom: var(--space-4);
        }
        .guide-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        .guide-label {
            font-size: var(--text-xs);
            color: var(--gray-400);
            font-family: var(--font-mono);
        }
        /* Color swatches */
        .color-swatch {
            width: 80px;
            height: 48px;
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }
        .color-swatch--wide {
            width: 120px;
        }
        /* Spacing demo */
        .spacing-demo {
            height: 24px;
            background: var(--accent);
            border-radius: var(--radius-sm);
        }
        /* Typography demo */
        .type-demo {
            color: var(--gray-800);
        }
        /* Shadow demo */
        .shadow-demo {
            width: 80px;
            height: 48px;
            background: white;
            border-radius: var(--radius-md);
        }
        /* Demo containers */
        .demo-box {
            padding: var(--space-4);
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
        }
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-4);
        }
        /* Tab system */
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* Ensure header stays on top */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        /* Pages layout with sidebar */
        .pages-layout {
            display: flex;
            height: calc(100vh - 52px);
            overflow: hidden;
        }
        .pages-sidebar {
            width: 220px;
            min-width: 220px;
            background: transparent;
            border-right: 1px solid var(--gray-200);
            padding: var(--space-4);
            overflow-y: auto;
        }
        .pages-sidebar__title {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--gray-400);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-3);
        }
        .pages-sidebar__list {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        .page-link {
            display: block;
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-sm);
            color: var(--gray-600);
            text-decoration: none;
            border-radius: var(--radius-sm);
            border-left: 2px solid transparent;
            margin-left: -2px;
            transition: all 0.15s ease;
        }
        .page-link:hover {
            background: var(--gray-100);
            color: var(--gray-800);
        }
        .page-link:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--accent-light);
        }
        .page-link:focus-visible {
            box-shadow: 0 0 0 2px var(--accent);
        }
        .page-link.active {
            background: var(--accent-light);
            color: var(--accent);
            font-weight: 500;
            border-left-color: var(--accent);
        }
        .pages-preview {
            flex: 1;
            background: var(--gray-100);
            padding: var(--space-4);
            overflow: hidden;
        }
        .pages-preview__frame {
            width: 100%;
            height: 100%;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            background: white;
        }
        /* Record iframe layout */
        .record-layout {
            height: calc(100vh - 52px);
            overflow: hidden;
        }
        .record-layout__frame {
            width: 100%;
            height: 100%;
            border: none;
        }
        /* Sandbox layout */
        .sandbox-layout {
            padding: var(--space-6);
            max-width: 1100px;
            margin: 0 auto;
        }
        .sandbox-header {
            margin-bottom: var(--space-6);
        }
        .sandbox-header__title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }
        .sandbox-header__subtitle {
            font-size: var(--text-sm);
            color: var(--gray-500);
        }
        .sandbox-area {
            min-height: 400px;
            background: white;
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-400);
            font-size: var(--text-sm);
        }
        /* Home page */
        .home-layout {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-6);
        }
        .home-hero {
            text-align: center;
            margin-bottom: var(--space-8);
        }
        .home-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }
        .home-subtitle {
            font-size: var(--text-base);
            color: var(--gray-500);
            max-width: 500px;
            margin: 0 auto;
        }
        /* 8-bit Pixel Art - Proxa Logo */
        .pixel-art {
            margin-top: var(--space-8);
            margin-bottom: var(--space-6);
        }
        .pixel-grid {
            display: grid;
            grid-template-columns: repeat(10, 10px);
            gap: 1px;
            justify-content: center;
            background: #1a1625;
            padding: 20px;
            border-radius: var(--radius-lg);
            width: fit-content;
            margin: 0 auto;
        }
        .px {
            width: 10px;
            height: 10px;
            background: #1a1625;
        }
        .px.w { background: #f5f5f5; }
        .px.g { background: #a0a0a0; }
        /* Password Gate */
        .password-gate {
            position: fixed;
            inset: 0;
            background: white;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: var(--space-4);
        }
        .password-gate.hidden { display: none; }
        .password-gate__title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-800);
        }
        .password-gate__form {
            display: flex;
            gap: var(--space-2);
        }
        .password-gate__input {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: var(--text-sm);
            width: 200px;
        }
        .password-gate__input:focus {
            outline: none;
            border-color: var(--accent);
        }
        .password-gate__error {
            color: var(--error);
            font-size: var(--text-sm);
            height: 20px;
        }

        /* ===================================
           MOBILE RESPONSIVE STYLES
           =================================== */

        @media (max-width: 768px) {
            /* App header adjustments */
            .app-header {
                flex-wrap: wrap;
                padding: var(--space-3);
            }

            .app-header__divider {
                display: none;
            }

            .app-tabs {
                width: 100%;
                overflow-x: auto;
                margin-top: var(--space-2);
                padding-bottom: var(--space-2);
                gap: var(--space-1);
            }

            .app-tab {
                white-space: nowrap;
                padding: var(--space-2) var(--space-3);
                font-size: var(--text-sm);
            }

            /* Pages layout - stack sidebar on mobile */
            .pages-layout {
                flex-direction: column;
                height: auto;
            }

            .pages-sidebar {
                width: 100%;
                min-width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--gray-200);
                padding: var(--space-3);
                max-height: 200px;
                overflow-y: auto;
            }

            .pages-sidebar__title {
                font-size: 11px;
            }

            .page-link {
                padding: var(--space-2);
                font-size: var(--text-xs);
            }

            .pages-preview {
                height: calc(100vh - 300px);
                min-height: 400px;
            }

            .pages-preview__frame {
                border-radius: 0;
            }

            /* Content padding adjustments */
            .app-content {
                padding: var(--space-4);
            }

            /* Demo grids */
            .demo-grid {
                grid-template-columns: 1fr;
            }

            /* Guide sections */
            .guide-section {
                margin-bottom: var(--space-6);
                padding-bottom: var(--space-4);
            }

            .guide-row {
                flex-direction: column;
                align-items: stretch;
            }

            /* Color swatches */
            .color-swatch {
                width: 100%;
                max-width: 200px;
            }

            /* Sandbox tab */
            #tab-sandbox {
                padding: var(--space-4);
            }
        }

        @media (max-width: 480px) {
            /* Even smaller screens */
            .app-header {
                padding: var(--space-2);
            }

            .app-content {
                padding: var(--space-3);
            }

            .pages-sidebar {
                padding: var(--space-2);
                max-height: 150px;
            }

            .pages-preview {
                height: calc(100vh - 250px);
            }

            .guide-title {
                font-size: 1.25rem;
            }

            .demo-box {
                padding: var(--space-3);
            }
        }
    </style>
</head>
<body>
    <!-- Password Gate -->
    <div class="password-gate" id="password-gate">
        <div class="password-gate__title">Enter Password</div>
        <div class="password-gate__form">
            <input type="password" class="password-gate__input" id="password-input" placeholder="Password" autofocus>
            <button class="btn btn--primary" onclick="checkPassword()">Enter</button>
        </div>
        <div class="password-gate__error" id="password-error"></div>
    </div>

    <script>
        const SITE_PASSWORD = 'proxa';
        const STORAGE_KEY = 'proxa-auth';

        function checkPassword() {
            const input = document.getElementById('password-input');
            if (input.value === SITE_PASSWORD) {
                sessionStorage.setItem(STORAGE_KEY, 'true');
                document.getElementById('password-gate').classList.add('hidden');
            } else {
                document.getElementById('password-error').textContent = 'Incorrect password';
                input.value = '';
                input.focus();
            }
        }

        document.getElementById('password-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') checkPassword();
        });

        // Check if already authenticated this session
        if (sessionStorage.getItem(STORAGE_KEY) === 'true') {
            document.getElementById('password-gate').classList.add('hidden');
        }
    </script>

    <!-- Header -->
    <header class="app-header">
        <span class="app-header__logo">Proxa</span>
        <div class="app-header__divider"></div>
        <span class="app-header__title">Sandbox</span>
        <nav class="app-tabs">
            <button class="app-tab active" data-tab="home" onclick="switchTab('home')">Home</button>
            <button class="app-tab" data-tab="record" onclick="switchTab('record')">Record</button>
            <button class="app-tab" data-tab="pages" onclick="switchTab('pages')">Pages</button>
            <button class="app-tab" data-tab="styleguide" onclick="switchTab('styleguide')">Style</button>
            <button class="app-tab" data-tab="references" onclick="switchTab('references')">References</button>
        </nav>
    </header>

    <!-- Home Tab -->
    <div class="tab-content active" id="tab-home">
        <div class="home-layout">
            <div class="home-hero">
                <!-- 8-bit Proxa Logo -->
                <div class="pixel-art">
                    <div class="pixel-grid">
                        <!-- Row 1: Arrow tip -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 2: Arrow -->
                        <div class="px"></div><div class="px w"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 3: P top with arrow -->
                        <div class="px w"></div><div class="px"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 4: P bowl top -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 5: P bowl -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 6: P bowl bottom -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 7: Stem -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 8: Stem -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 9: Stem -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                        <!-- Row 10: Stem base -->
                        <div class="px"></div><div class="px"></div><div class="px w"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div><div class="px"></div>
                    </div>
                </div>
                <h1 class="home-title">Brandon's Sandbox</h1>
                <p class="home-subtitle">A prototyping environment for UI components, patterns, and AI-powered workflows.</p>
            </div>
        </div>
    </div>

    <!-- Style Guide Tab -->
    <div class="tab-content" id="tab-styleguide">
        <div class="pages-layout">
            <aside class="pages-sidebar">
                <div class="pages-sidebar__title">Foundations</div>
                <div class="pages-sidebar__list">
                    <a href="#" class="page-link active" onclick="loadStyleGuide(this, 'tests/foundations/tokens.html'); return false;">Tokens</a>
                </div>
                <div class="pages-sidebar__title" style="margin-top: var(--space-5);">Elements</div>
                <div class="pages-sidebar__list">
                    <a href="#" class="page-link" onclick="loadStyleGuide(this, 'tests/elements/button.test.html'); return false;">Button</a>
                    <a href="#" class="page-link" onclick="loadStyleGuide(this, 'tests/elements/badge.test.html'); return false;">Badge</a>
                </div>
                <div class="pages-sidebar__title" style="margin-top: var(--space-5);">Components</div>
                <div class="pages-sidebar__list">
                    <a href="#" class="page-link" onclick="loadStyleGuide(this, 'tests/components/metric-card.test.html'); return false;">Metric Card</a>
                    <a href="#" class="page-link" onclick="loadStyleGuide(this, 'tests/components/hub-card.test.html'); return false;">Hub Card</a>
                    <a href="#" class="page-link" onclick="loadStyleGuide(this, 'tests/components/file-item.test.html'); return false;">File Item</a>
                    <a href="#" class="page-link" onclick="loadStyleGuide(this, 'tests/components/fin-table.test.html'); return false;">Financial Table</a>
                </div>
            </aside>
            <div class="pages-preview">
                <iframe src="tests/foundations/tokens.html" class="pages-preview__frame" id="styleguide-frame"></iframe>
            </div>
        </div>
    </div>

    <!-- Record Tab -->
    <div class="tab-content" id="tab-record">
        <div class="record-layout">
            <iframe src="patterns/record.html" class="record-layout__frame" id="record-frame"></iframe>
        </div>
    </div>

    <!-- Pages Tab -->
    <div class="tab-content" id="tab-pages">
        <div class="pages-layout">
            <aside class="pages-sidebar">
                <!-- STYLE GUIDE: Design tokens, elements, components -->
                <div class="pages-sidebar__title">Style Guide</div>
                <div class="pages-sidebar__list">
                    <a href="#" class="page-link active" data-page="templates/component-reference.html" onclick="loadPage(this, 'templates/component-reference.html'); return false;">Component Reference</a>
                    <a href="#" class="page-link" data-page="tests/foundations/tokens.html" onclick="loadPage(this, 'tests/foundations/tokens.html'); return false;">Tokens</a>
                    <a href="#" class="page-link" data-page="tests/elements/button.test.html" onclick="loadPage(this, 'tests/elements/button.test.html'); return false;">Buttons</a>
                    <a href="#" class="page-link" data-page="tests/elements/badge.test.html" onclick="loadPage(this, 'tests/elements/badge.test.html'); return false;">Badges</a>
                    <a href="#" class="page-link" data-page="tests/components/metric-card.test.html" onclick="loadPage(this, 'tests/components/metric-card.test.html'); return false;">Metric Card</a>
                    <a href="#" class="page-link" data-page="tests/components/hub-card.test.html" onclick="loadPage(this, 'tests/components/hub-card.test.html'); return false;">Hub Card</a>
                    <a href="#" class="page-link" data-page="tests/components/file-item.test.html" onclick="loadPage(this, 'tests/components/file-item.test.html'); return false;">File Item</a>
                    <a href="#" class="page-link" data-page="tests/components/fin-table.test.html" onclick="loadPage(this, 'tests/components/fin-table.test.html'); return false;">Financial Table</a>
                </div>

                <!-- TEMPLATES: Empty structural skeletons -->
                <div class="pages-sidebar__title" style="margin-top: var(--space-5);">Templates</div>
                <div class="pages-sidebar__list">
                    <a href="#" class="page-link" data-page="templates/dashboard-layout.html" onclick="loadPage(this, 'templates/dashboard-layout.html'); return false;">Dashboard Layout</a>
                    <a href="#" class="page-link" data-page="templates/presentation-layout.html" onclick="loadPage(this, 'templates/presentation-layout.html'); return false;">Presentation Layout</a>
                    <a href="#" class="page-link" data-page="templates/report-layout.html" onclick="loadPage(this, 'templates/report-layout.html'); return false;">Report Layout</a>
                    <a href="#" class="page-link" data-page="templates/data-review-layout.html" onclick="loadPage(this, 'templates/data-review-layout.html'); return false;">Data Review Layout</a>
                </div>

                <!-- EXAMPLES: Finished pages with real content -->
                <div class="pages-sidebar__title" style="margin-top: var(--space-5);">Examples</div>
                <div class="pages-sidebar__list">
                    <a href="#" class="page-link" data-page="pages/dashboard.html" onclick="loadPage(this, 'pages/dashboard.html'); return false;">Dashboard Example</a>
                    <a href="#" class="page-link" data-page="pages/presentation.html" onclick="loadPage(this, 'pages/presentation.html'); return false;">Presentation Example</a>
                </div>
            </aside>
            <div class="pages-preview">
                <iframe src="templates/component-reference.html" class="pages-preview__frame" id="pages-frame"></iframe>
            </div>
        </div>
    </div>

    <!-- References Tab -->
    <div class="tab-content" id="tab-references">
        <div class="pages-layout">
            <aside class="pages-sidebar">
                <div class="pages-sidebar__list">
                    <a href="#" class="page-link active" onclick="loadReference(this, 'references/index.html'); return false;">All References</a>
                    <div style="height: 1px; background: var(--gray-200); margin: var(--space-3) 0;"></div>
                    <a href="#" class="page-link" onclick="loadReference(this, 'references/notes.html'); return false;">Notes</a>
                    <a href="#" class="page-link" onclick="loadReference(this, 'references/audit-report.html'); return false;">Audit Report</a>
                    <a href="#" class="page-link" onclick="loadReference(this, 'references/ai-blocks.html'); return false;">AI Blocks Spec</a>
                    <a href="#" class="page-link" onclick="loadReference(this, 'references/responsive-slide.html'); return false;">Responsive Slide</a>
                </div>
            </aside>
            <div class="pages-preview">
                <iframe src="references/index.html" class="pages-preview__frame" id="references-frame"></iframe>
            </div>
        </div>
    </div>

    <!-- Demo Modal -->
    <div class="modal-overlay" id="demo-modal">
        <div class="modal">
            <div class="modal__header">
                <span class="modal__title">Modal Title</span>
                <button class="modal__close" onclick="document.getElementById('demo-modal').classList.remove('open')">×</button>
            </div>
            <div class="modal__body">
                <p style="font-size: var(--text-sm); color: var(--gray-600);">This is a modal dialog. Modals are used for focused tasks, confirmations, or displaying important information.</p>
            </div>
            <div class="modal__footer modal__footer--right">
                <button class="btn" onclick="document.getElementById('demo-modal').classList.remove('open')">Cancel</button>
                <button class="btn btn--primary" onclick="document.getElementById('demo-modal').classList.remove('open')">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Demo Slide Panel -->
    <div class="overlay" onclick="closePanel()"></div>
    <div class="panel" id="demo-panel">
        <div class="panel__header">
            <span class="panel__title">Panel Title</span>
            <button class="panel__close" onclick="closePanel()">×</button>
        </div>
        <div class="panel__content">
            <div class="panel-section">
                <div class="panel-section__title">Section</div>
                <p style="font-size: var(--text-sm); color: var(--gray-600);">Slide panels appear from the right side of the screen. They're used for detail views, settings, and secondary content.</p>
            </div>
        </div>
    </div>

    <!-- Tab switching (runs immediately, no dependencies) -->
    <script>
        function switchTab(tabName) {
            // Update active tab button
            document.querySelectorAll('.app-tab[data-tab]').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tabName);
            });
            // Show target content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === 'tab-' + tabName);
            });
        }
        window.switchTab = switchTab;
        window.switchToTab = switchTab; // alias for style guide button

        // Page sidebar navigation
        function loadPage(link, pageSrc) {
            // Update active link in pages sidebar only
            document.querySelectorAll('#tab-pages .page-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            // Load page in iframe
            document.getElementById('pages-frame').src = pageSrc;
        }
        window.loadPage = loadPage;

        // Style guide sidebar navigation
        function loadStyleGuide(link, pageSrc) {
            // Update active link in styleguide sidebar only
            document.querySelectorAll('#tab-styleguide .page-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            // Load page in iframe
            document.getElementById('styleguide-frame').src = pageSrc;
        }
        window.loadStyleGuide = loadStyleGuide;

        // References sidebar navigation
        function loadReference(link, pageSrc) {
            // Update active link in references sidebar only
            document.querySelectorAll('#tab-references .page-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            // Load page in iframe
            document.getElementById('references-frame').src = pageSrc;
        }
        window.loadReference = loadReference;
    </script>

    <script type="module">
        import { initDropdowns } from './js/dropdown.js';
        import { showToast } from './js/toast.js';
        import { openPanel, closePanel, initPanels } from './js/slide-panel.js';

        // Make functions globally available for onclick handlers
        window.showToast = showToast;
        window.openPanel = openPanel;
        window.closePanel = closePanel;

        // Initialize
        initDropdowns();
        initPanels();

        // Modal: Escape key and backdrop click to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.open').forEach(m => m.classList.remove('open'));
            }
        });
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) overlay.classList.remove('open');
            });
        });

        // Pages sidebar navigation
        const pageLinks = document.querySelectorAll('.page-link');
        const pagesFrame = document.getElementById('pages-frame');

        pageLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageSrc = link.dataset.page;

                // Update active link
                pageLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                // Load page in iframe
                pagesFrame.src = pageSrc;
            });
        });

        // Demo Chart (Chart.js) - 12-month financial data from prototype
        const chartData = {
            labels: ["Jan '24", "Feb '24", "Mar '24", "Apr '24", "May '24", "Jun '24", "Jul '24", "Aug '24", "Sep '24", "Oct '24", "Nov '24", "Dec '24"],
            datasets: [
                {
                    label: 'Revenue',
                    data: [1236577, 1425890, 1312445, 1567234, 1489012, 1723456, 1856789, 1645321, 1934567, 2123456, 2345678, 2567890],
                    borderColor: '#4a6fa5',
                    backgroundColor: 'rgba(74, 111, 165, 0.1)',
                    fill: true,
                    tension: 0.3
                },
                {
                    label: 'Expenses',
                    data: [856234, 912456, 878901, 1023456, 989123, 1145678, 1234567, 1098765, 1289012, 1412345, 1534567, 1678901],
                    borderColor: '#6b8f71',
                    backgroundColor: 'rgba(107, 143, 113, 0.1)',
                    fill: true,
                    tension: 0.3
                },
                {
                    label: 'Profit',
                    data: [380343, 513434, 433544, 543778, 499889, 577778, 622222, 546556, 645555, 711111, 811111, 888989],
                    borderColor: '#c9a227',
                    backgroundColor: 'rgba(201, 162, 39, 0.1)',
                    fill: true,
                    tension: 0.3
                }
            ]
        };

        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { font: { size: 10 }, color: '#78716c' }
                },
                y: {
                    grid: { color: '#e7e5e4' },
                    ticks: {
                        font: { size: 10 },
                        color: '#78716c',
                        callback: v => '$' + (v/1000000).toFixed(1) + 'M'
                    }
                }
            }
        };

        const demoChart = new Chart(document.getElementById('demo-chart'), {
            type: 'line',
            data: chartData,
            options: chartOptions
        });

        // Update legend
        document.getElementById('demo-chart-legend').innerHTML = chartData.datasets.map(d => `
            <div class="legend-item">
                <span class="legend-color" style="background: ${d.borderColor}"></span>
                ${d.label}
            </div>
        `).join('');

        // Chart type switcher
        document.getElementById('demo-chart-type').addEventListener('change', (e) => {
            const type = e.target.value;
            demoChart.config.type = type;
            demoChart.data.datasets.forEach(d => {
                d.fill = type === 'line';
                d.borderWidth = type === 'bar' ? 0 : 2;
                d.backgroundColor = type === 'bar' ? d.borderColor : d.backgroundColor;
            });
            demoChart.update();
        });

        // Demo Waterfall Chart - Revenue to Profit bridge (values in $M)
        const waterfallData = [
            { label: 'Revenue', sublabel: '2024', value: 20.2, type: 'total' },
            { label: 'Tour', sublabel: 'Packages', value: 2.4, type: 'increase' },
            { label: 'Services', sublabel: '', value: 1.8, type: 'increase' },
            { label: 'COGS', sublabel: '', value: -5.2, type: 'decrease' },
            { label: 'OpEx', sublabel: '', value: -8.8, type: 'decrease' },
            { label: 'Profit', sublabel: '2024', value: 6.2, type: 'total' }
        ];

        const maxVal = Math.max(...waterfallData.map(d => Math.abs(d.value)));
        const scale = 180 / maxVal;
        let runningTotal = 0;

        const waterfallHTML = waterfallData.map((item, i) => {
            let barHeight, barBottom;

            if (item.type === 'total') {
                barHeight = item.value * scale;
                barBottom = 0;
                runningTotal = item.value;
            } else {
                barHeight = Math.abs(item.value) * scale;
                if (item.value > 0) {
                    barBottom = runningTotal * scale;
                    runningTotal += item.value;
                } else {
                    runningTotal += item.value;
                    barBottom = runningTotal * scale;
                }
            }

            const barClass = item.type === 'total' ? 'waterfall__bar--total' :
                           item.value > 0 ? 'waterfall__bar--increase' : 'waterfall__bar--decrease';

            return `
                <div class="waterfall__bar-group">
                    <div class="waterfall__bar-wrapper" style="bottom: ${barBottom}px">
                        <div class="waterfall__bar ${barClass}" style="height: ${barHeight}px">
                            <span class="waterfall__value">${item.value > 0 && item.type !== 'total' ? '+' : ''}$${Math.abs(item.value).toFixed(1)}M</span>
                        </div>
                    </div>
                    <div class="waterfall__label">
                        <strong>${item.label}</strong>
                        ${item.sublabel}
                    </div>
                </div>
            `;
        }).join('');

        document.getElementById('demo-waterfall').innerHTML = waterfallHTML + '<div class="waterfall__axis"></div>';
    </script>
</body>
</html>
